<h1> <%= "#{@listing.product.name} [#{@listing.product.model}]" %> </h1>

<%# flash notice when updated form is sent %>
<% if flash[:notice] %>
    <div class="notice"><%= flash[:notice] %></div>
<% end %>

<h3> Seller: <%= @listing.user.full_name %> </h3>

<%# ability for Seller to edit listing order %>
<% if @listing.user_id == current_user.id %>
        <% if @listing.product.type_id == 1 %>
            <%= link_to "Edit my iPhone listing", editiphone_path(@listing) %>
        <% else %> 
            <%= link_to "Edit my MacBook listing", editmacbook_path(@listing) %>
        <% end %>
<% end %>

<h3> Price: $<%= number_with_precision(@listing.price, precision: 2) %> </h3> 

<h4> Condition: <%= @listing.condition %> </h4>
<h4> Color: <%= @listing.color %> </h4>
<h4> Storage: <%= @listing.storage %> </h4>
<h4> Memory: <%= @listing.memory %> </h4>

<%= form_with scope: :exchange, url: exchanges_path do |f| %>
    <%= f.hidden_field :user_id, value: current_user.id %>
    <%= f.hidden_field :listing_id, value: @listing.id%>
    <% if @listing.active == false %>
        <h2>SOLD</h2>
    <% elsif @listing.user.id != current_user.id %>
        <% if current_user.balance < @listing.price %>
            <h3>You don't have enough money to purchase this listing</h3>
        <% else %>
            <%= f.submit "Buy Now" %>
        <% end %>
    <% end %>
<% end %>


<h3> Comments (<%= @listing.comments.size %>) </h3>

<% @listing.comments.each do |comment| %>
    <%= comment.user.first_name %> posted <%= distance_of_time_in_words(comment.listing.created_at, comment.created_at) %> later at <%= comment.created_at%>
        <br>
    <font color="red"> <%= comment.content %> </font>
        <br><br>
<% end %>

<%= render partial: 'comments/form' %>